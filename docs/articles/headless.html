<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Headless Browsing â€¢ RSelenium</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Headless Browsing">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RSelenium</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.7.4.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basics.html">Basics</a>
    </li>
    <li>
      <a href="../articles/docker.html">Docker</a>
    </li>
    <li>
      <a href="../articles/headless.html">Headless Browsing</a>
    </li>
    <li>
      <a href="../articles/internetexplorer.html">Internet Explorer</a>
    </li>
    <li>
      <a href="../articles/saucelabs.html">Driving OS/Browsers Local and Remote</a>
    </li>
    <li>
      <a href="../articles/shinytesting.html">Testing Shiny Apps</a>
    </li>
    <li>
      <a href="../articles/webinar.html">OCRUG Webinar</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Headless Browsing</h1>
            
      
      
      <div class="hidden name"><code>headless.Rmd</code></div>

    </div>

    
    
<div id="phantomjs" class="section level2">
<h2 class="hasAnchor">
<a href="#phantomjs" class="anchor"></a>PhantomJS</h2>
<p><code>PhantomJS</code> is a headless WebKit scriptable with a JavaScript API. It has fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG. <code>RSelenium</code> can drive <code>PhantomJS</code> using two methods: directly or via the standalone Selenium Server.</p>
<div id="driving-phantomjs-directly" class="section level3">
<h3 class="hasAnchor">
<a href="#driving-phantomjs-directly" class="anchor"></a>Driving PhantomJS Directly</h3>
<p>The <code>PhantomJS</code> binary can be driven directly with <code>RSelenium</code>. <code>PhantomJS</code> needs to be started in webdriver mode then <code>RSelenium</code> can <strong>communicate with it directly without the need for Selenium Server.</strong> The command line options for <code>PhantomJS</code> are outlined at <a href="http://phantomjs.org/api/command-line.html">http://phantomjs.org/api/command-line.html</a>. We note that it is necessary to start <code>PhantomJS</code> with the <code>--webdriver</code> option and an optional IP/port. <code>RSelenium</code> as of <code>v1.3.2</code> has a utility function <code>phantom</code> that will handle starting the <code>PhantomJS</code> binary in webdriver mode by default on port 4444. So to drive <code>PhantomJS</code> sans Selenium Server can be done as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">require</span>(RSelenium)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">Sys.sleep</span>(<span class="dv">5</span>) <span class="co"># give the binary a moment</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">'phantomjs'</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">remDr<span class="op">$</span><span class="kw">getTitle</span>()[[<span class="dv">1</span>]] <span class="co"># [1] "Google"</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">remDr<span class="op">$</span>close</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">pJS<span class="op">$</span><span class="kw">stop</span>() <span class="co"># close the PhantomJS process, note we dont call remDr$closeServer()</span></a></code></pre></div>
</div>
<div id="driving-phantomjs-using-selenium-server" class="section level3">
<h3 class="hasAnchor">
<a href="#driving-phantomjs-using-selenium-server" class="anchor"></a>Driving PhantomJS Using Selenium Server</h3>
<p>For completeness we outline the process of opening a <code>PhantomJS</code> browser using selenium server. It is assummed that the <code>PhantomJS</code> binary is in the users path.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">require</span>(RSelenium)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">RSelenium<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/RSelenium/topics/startServer">startServer</a></span>()</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantomjs"</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">remDr<span class="op">$</span><span class="kw">close</span>()</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">remDr<span class="op">$</span><span class="kw">closeServer</span>()</a></code></pre></div>
<div id="providing-the-phantomjs-path" class="section level4">
<h4 class="hasAnchor">
<a href="#providing-the-phantomjs-path" class="anchor"></a>Providing the PhantomJS Path</h4>
<p>It may not be possible for a user to have the <code>PhantomJS</code> binary in their path. In this case a user may pass the path of the <code>PhantomJS</code> binary to Selenium Server:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">require</span>(RSelenium)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">RSelenium<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/RSelenium/topics/startServer">startServer</a></span>()</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">eCap &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">phantomjs.binary.path =</span> <span class="st">"C:/Users/john/Desktop/phantomjs.exe"</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantomjs"</span>, <span class="dt">extraCapabilities =</span> eCap)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">....</a></code></pre></div>
<p>So in the above example I suppose the <code>PhantomJS</code> binary has been moved to my Desktop which we assume is not in my path. An extra capability <code>phantomjs.binary.path</code> detailed <a href="https://github.com/detro/ghostdriver">https://github.com/detro/ghostdriver</a> can be used to provide the path to <code>PhantomJS</code> to Selenium Server.</p>
</div>
</div>
<div id="additional-phantomjs-capabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-phantomjs-capabilities" class="anchor"></a>Additional PhantomJS Capabilities</h3>
<div id="setting-a-user-agent" class="section level4">
<h4 class="hasAnchor">
<a href="#setting-a-user-agent" class="anchor"></a>Setting a User Agent</h4>
<p>A user agent can be set using the <code>phantomjs.page.settings.userAgent</code> capability.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">Sys.sleep</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantomjs"</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.whatsmyuseragent.com/"</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="st">"id"</span>, <span class="st">"userAgent"</span>)<span class="op">$</span><span class="kw">getElementText</span>()[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] "Your User Agent String is:\nMozilla/5.0 (Unknown; Linux x86_64)
## AppleWebKit/534.34 (KHTML, like Gecko) PhantomJS/1.9.7 Safari/534.34"</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">remDr<span class="op">$</span><span class="kw">close</span>()</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">eCap &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">phantomjs.page.settings.userAgent =</span> <span class="st">"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:29.0) Gecko/20120101 Firefox/29.0"</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantomjs"</span>, <span class="dt">extraCapabilities =</span> eCap)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.whatsmyuseragent.com/"</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="st">"id"</span>, <span class="st">"userAgent"</span>)<span class="op">$</span><span class="kw">getElementText</span>()[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] "Your User Agent String is:\nMozilla/5.0 (Windows NT 6.1; WOW64; rv:29.0)
## Gecko/20120101 Firefox/29.0"</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">remDr<span class="op">$</span><span class="kw">close</span>()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">pJS<span class="op">$</span><span class="kw">stop</span>()</a></code></pre></div>
<p>The <a href="https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage#webpage-settings" class="uri">https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage#webpage-settings</a> In the above example it can be seen that the default useragent identifies us as <code>PhantomJS</code>. Some web content maybe inaccessible or blocked for <code>PhantomJS</code> users. Here we demonstrate changing our user agent so the website sees us as <code>Firefox 29.0</code>.</p>
</div>
<div id="other-possible-options" class="section level4">
<h4 class="hasAnchor">
<a href="#other-possible-options" class="anchor"></a>Other Possible Options</h4>
<p>The general form of specifying <a href="https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage#webpage-settings">PhantomJS internal page objects</a> take the form <code>phantomjs.page.settings.SETTING = VALUE</code> where <code>SETTING</code> is the appropriate PhantomJS internal page object. As an example we inhibit the loading of inline images:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">require</span>(RSelenium)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">Sys.sleep</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">eCap &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">phantomjs.page.settings.loadImages =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantomjs"</span>, <span class="dt">extraCapabilities =</span> eCap)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">remDr<span class="op">$</span><span class="kw">close</span>()</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">pJS<span class="op">$</span><span class="kw">stop</span>()</a></code></pre></div>
<p>We can see that the images are not loaded: <img src="https://res.cloudinary.com/johndharrison/image/upload/v1497012298/RSelenium/headless/Screenshot_2014-06-03_14.32.18.png" title="PhantomJS loadImages = FALSE" style="margin-left: auto;margin-right: auto; display: block;" width="100%"></p>
</div>
</div>
</div>
<div id="x-virtual-frame-buffer" class="section level2">
<h2 class="hasAnchor">
<a href="#x-virtual-frame-buffer" class="anchor"></a>X Virtual Frame Buffer</h2>
<p>For the discussion on <code>xvfb</code> and the related VPS, I refer you to <a href="http://johndharrison.blogspot.com/2014/03/rstudioshiny-server-on-digital-ocean.html">this blog entry</a>. How to setup a VPS with rstudio server and shiny server etc. is outlined.</p>
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>The VPS i am connecting to has an ip of <code>128.199.255.233</code>. I have rstudio server running on port 8787. On the remote server we observe</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">library</span>(RSelenium)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">RSelenium<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/RSelenium/topics/startServer">startServer</a></span>()</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">Sys.which</span>(<span class="st">'phantomjs'</span>)</a></code></pre></div>
<pre><code>                 phantomjs
"/usr/local/bin/phantomjs"</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">Sys.which</span>(<span class="st">'firefox'</span>)</a></code></pre></div>
<pre><code>firefox
     ""</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">Sys.which</span>(<span class="st">'chrome'</span>)</a></code></pre></div>
<pre><code>chrome
    ""</code></pre>
<p>So we have started a selenium server running on (default) port 4444. Firefox and google chrome are not currently installed on this remote machine. Lets install firefox first. On the remote VPS we run</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="fu">sudo</span> apt-get install firefox</a></code></pre></div>
<p>Now checking in the remote rstudio</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">Sys.which</span>(<span class="st">'firefox'</span>)</a></code></pre></div>
<pre><code>##            firefox 
## "/usr/bin/firefox" </code></pre>
<p>If we try now to connect to the remote server and open firefox:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">remoteServerAddr =</span> <span class="st">"128.199.255.233"</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">remDr<span class="op">$</span><span class="kw">open</span>()</a></code></pre></div>
<pre><code>## [1] "Connecting to remote server"
## Error:    Summary: UnknownError
##    Detail: An unknown server-side error occurred while processing the command.
##    class: org.openqa.selenium.WebDriverException</code></pre>
<p>We can see the problem if we try to run firefox in the remote shell:</p>
<p><img src="https://res.cloudinary.com/johndharrison/image/upload/v1497012290/RSelenium/headless/firefox.png" title="PhantomJS loadImages = FALSE" style="margin-left: auto;margin-right: auto; display: block;" width="100%"></p>
<p>Firefox is install but there is no display on our headless VPS. We can use <a href="http://www.x.org/archive/X11R7.7/doc/man/man1/Xvfb.1.xhtml">xvfb</a> to provide a virtual display for our browser to run in.</p>
<pre><code>Xvfb :0 -screen 0 1024x768x24 2&gt;&amp;1 &gt;/dev/null &amp;
export DISPLAY=:0
nohup xvfb-run java -jar selenium-server-standalone.jar &gt; selenium.log &amp;</code></pre>
</div>
</div>
<div id="phantomjs-api-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#phantomjs-api-examples" class="anchor"></a>PhantomJS API Examples</h2>
<p>The <code>phantomExecute</code> method of the <code>remoteDriver</code> class allows the user to interact with the <code>PhantomJS</code> API. Currently the method only works for direct calls to <code>PhantomJS</code> using the <code>phantom</code> utility function. Driving <code>PhantomJS</code> through the <code>Selenium</code> Server and calling the <code>phantomExecute</code> method currently doesnt function and is an open issue (in the ghostDriver project). In the following sections we outline examples of using the <code>PhantomJS</code> API.</p>
<div id="interacting-with-the-console" class="section level3">
<h3 class="hasAnchor">
<a href="#interacting-with-the-console" class="anchor"></a>Interacting with the Console</h3>
<p>The <code>PhantomJS</code> API implements a number of callbacks which can be defined. <a href="http://phantomjs.org/api/webpage/handler/on-load-finished.html">onLoadFinished</a> is one such callback. This callback is invoked when the page finishes the loading. It may accept a single argument indicating the pages status: <code>success</code> if no network errors occurred, otherwise <code>fail</code>.</p>
<p>We give a simple example of writing to the console log when a page is loaded.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">library</span>(RSelenium)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantom"</span>)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">result &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">phantomExecute</span>(<span class="st">"var page = this;</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="st">                                page.onLoadFinished = function(status) {</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="st">                                var url = page.url;</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="st">                                console.log(</span><span class="ch">\"</span><span class="st">Status:  </span><span class="ch">\"</span><span class="st"> + status);</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="st">                                console.log(</span><span class="ch">\"</span><span class="st">Loaded:  </span><span class="ch">\"</span><span class="st"> + url);</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="st">                               };"</span>)</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a></code></pre></div>
<pre><code>## Status:  success
## Loaded:  http://www.google.com/</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.bbc.co.uk"</span>)</a></code></pre></div>
<pre><code>## Status:  success
## Loaded:  http://www.bbc.co.uk/</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.bbc.com"</span>)</a></code></pre></div>
<pre><code>## Status:  success
## Loaded:  http://www.bbc.com/</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">pJS<span class="op">$</span><span class="kw">stop</span>()</a></code></pre></div>
<p>It can be seen that the callback persists across page calls.</p>
</div>
<div id="phantomjs-writing-to-file" class="section level3">
<h3 class="hasAnchor">
<a href="#phantomjs-writing-to-file" class="anchor"></a>PhantomJS Writing to File</h3>
<p>The next example demonstrates writing to file from <code>PhantomJS</code>. Once again the <code>onLoadFinished</code> callback is utilised. In this example the html source of the page that is navigated to is downloaded to <code>output.htm</code> relative to <code>getwd()</code>. An example is given of using <code>phantom.exit()</code> to close <code>PhantomJS</code> from the API.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">library</span>(RSelenium)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantom"</span>)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">result &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">phantomExecute</span>(<span class="st">"var page = this;</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="st">                                var fs = require(</span><span class="ch">\"</span><span class="st">fs</span><span class="ch">\"</span><span class="st">);</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="st">                                page.onLoadFinished = function(status) {</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="st">                                var file = fs.open(</span><span class="ch">\"</span><span class="st">output.htm</span><span class="ch">\"</span><span class="st">, </span><span class="ch">\"</span><span class="st">w</span><span class="ch">\"</span><span class="st">);</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="st">                                file.write(page.content);</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10"><span class="st">                                file.close();</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="st">                                phantom.exit();</span></a>
<a class="sourceLine" id="cb29-12" data-line-number="12"><span class="st">                               };"</span>)</a>
<a class="sourceLine" id="cb29-13" data-line-number="13">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a>
<a class="sourceLine" id="cb29-14" data-line-number="14"><span class="kw">htmlParse</span>(<span class="st">"output.htm"</span>)[<span class="st">'//title/text()'</span>][[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## Google</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">pJS<span class="op">$</span><span class="kw">stop</span>()</a></code></pre></div>
</div>
<div id="injecting-a-library-into-phantomjs" class="section level3">
<h3 class="hasAnchor">
<a href="#injecting-a-library-into-phantomjs" class="anchor"></a>Injecting a Library into PhantomJS</h3>
<p>Next we look at <a href="http://phantomjs.org/api/webpage/method/include-js.html">includeJs</a>.</p>
<p>This includes an external script from the specified url (usually a remote location) on the page and executes the callback upon completion. The library we shall include is <code>JQuery</code> using the google CDN. Now any page we call with <code>PhantomJS</code> will have the <code>JQuery</code> library loaded after the page has finished loading.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">library</span>(RSelenium)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantom"</span>)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co"># check if the JQuery library is loaded</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7">remDr<span class="op">$</span><span class="kw">executeScript</span>(<span class="st">"return window.jQuery == undefined;"</span>)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="co"># TRUE is returned indicating JQuery is not present</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9">result &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">phantomExecute</span>(<span class="st">"var page = this;</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="st">                                page.onLoadFinished = function(status) {</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="st">                                 var url = page.url;</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="st">                                 var jURL = 'http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js';</span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13"><span class="st">                                 console.log(</span><span class="ch">\"</span><span class="st">Status:  </span><span class="ch">\"</span><span class="st"> + status);</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="st">                                 console.log(</span><span class="ch">\"</span><span class="st">Loaded:  </span><span class="ch">\"</span><span class="st"> + url);</span></a>
<a class="sourceLine" id="cb32-15" data-line-number="15"><span class="st">                                 page.includeJs(jURL, function() {console.log(</span><span class="ch">\"</span><span class="st">Loaded jQuery!</span><span class="ch">\"</span><span class="st">);})</span></a>
<a class="sourceLine" id="cb32-16" data-line-number="16"><span class="st">                                };"</span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">                               )</a>
<a class="sourceLine" id="cb32-18" data-line-number="18">remDr<span class="op">$</span><span class="kw">navigate</span>(<span class="st">"http://www.google.com/ncr"</span>)</a></code></pre></div>
<pre><code>## Status:  success
## Loaded:  http://www.google.com/
## Loaded jQuery!</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">remDr<span class="op">$</span><span class="kw">executeScript</span>(<span class="st">"return window.jQuery == undefined;"</span>)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="co"># FALSE is returned indicating that JQuery is present</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3">webElem &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">executeScript</span>(<span class="st">"return $(</span><span class="ch">\"</span><span class="st">[name='q']</span><span class="ch">\"</span><span class="st">).get(0);"</span>)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">webElem<span class="op">$</span><span class="kw">sendKeysToElement</span>(<span class="kw">list</span>(<span class="st">"PhantomJS was here"</span>))</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">remDr<span class="op">$</span><span class="kw">screenshot</span>(<span class="dt">display =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb34-6" data-line-number="6">pJS<span class="op">$</span><span class="kw">stop</span>()</a></code></pre></div>
<p><img src="https://res.cloudinary.com/johndharrison/image/upload/v1497012295/RSelenium/headless/googlePhantomJS.png" title="PhantomJS with Jquery injected" style="margin-left: auto;margin-right: auto; display: block;" width="100%"></p>
</div>
<div id="starting-a-phantomjs-web-server" class="section level3">
<h3 class="hasAnchor">
<a href="#starting-a-phantomjs-web-server" class="anchor"></a>Starting a PhantomJS Web Server</h3>
<p><code>PhantomJS</code> has the ability to act as a <a href="http://phantomjs.org/api/webserver/">Web Server</a>. Here we demonstrate setting <code>PhantomJS</code> up as a web server on the localhost on port <code>8080</code>. When a user browses to <code>http://localhost:8080</code> they are returned a list of the current blog titles on <a href="http://www.r-bloggers.com">http://www.r-bloggers.com</a>. The <code>Jquery</code> library is also injected to aid extraction of the blog titles.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">pJS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/phantom.html">phantom</a></span>()</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">remDr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/remoteDriver-class.html">remoteDriver</a></span>(<span class="dt">browserName =</span> <span class="st">"phantom"</span>)</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">remDr<span class="op">$</span><span class="kw">open</span>()</a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="st">"</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="st">var server = require('webserver').create();</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="st">server.listen(8080, function (request, response) {</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="st">  var page = new WebPage();</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="st">  page.open('http://www.r-bloggers.com/', function (status) {</span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"><span class="st">    var jURL = 'http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js';</span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10"><span class="st">    page.includeJs(jURL, function() {</span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="st">      console.log(</span><span class="ch">\"</span><span class="st">Loaded jQuery!</span><span class="ch">\"</span><span class="st">);</span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="st">      var blogs = page.evaluate(function () {</span></a>
<a class="sourceLine" id="cb35-13" data-line-number="13"><span class="st">        res = $('#mainwrapper .post a[rel=</span><span class="ch">\"</span><span class="st">bookmark</span><span class="ch">\"</span><span class="st">]');</span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14"><span class="st">        return res.map(function(){return this.innerHTML}).toArray().join('</span><span class="ch">\\</span><span class="st">n');</span></a>
<a class="sourceLine" id="cb35-15" data-line-number="15"><span class="st">      });</span></a>
<a class="sourceLine" id="cb35-16" data-line-number="16"><span class="st">      response.statusCode = 200;</span></a>
<a class="sourceLine" id="cb35-17" data-line-number="17"><span class="st">      response.write('Current blogs on r-bloggers:</span><span class="ch">\\</span><span class="st">n');</span></a>
<a class="sourceLine" id="cb35-18" data-line-number="18"><span class="st">      response.write(blogs);</span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19"><span class="st">      response.write('</span><span class="ch">\\</span><span class="st">n');</span></a>
<a class="sourceLine" id="cb35-20" data-line-number="20"><span class="st">      response.close();</span></a>
<a class="sourceLine" id="cb35-21" data-line-number="21"><span class="st">      page.close();</span></a>
<a class="sourceLine" id="cb35-22" data-line-number="22"><span class="st">    });</span></a>
<a class="sourceLine" id="cb35-23" data-line-number="23"><span class="st">  });</span></a>
<a class="sourceLine" id="cb35-24" data-line-number="24"><span class="st">});"</span> -&gt;<span class="st"> </span>wsScript</a>
<a class="sourceLine" id="cb35-25" data-line-number="25"></a>
<a class="sourceLine" id="cb35-26" data-line-number="26">remDr<span class="op">$</span><span class="kw">phantomExecute</span>(wsScript)</a>
<a class="sourceLine" id="cb35-27" data-line-number="27"></a>
<a class="sourceLine" id="cb35-28" data-line-number="28"><span class="kw">head</span>(<span class="kw">readLines</span>(<span class="st">"http://localhost:8080/"</span>))</a></code></pre></div>
<pre><code>## Loaded jQuery!
## [1] "Current blogs on r-bloggers:"                        "Specifying complicated groups of time series in hts"
## [3] "Creating Inset Map with ggplot2"                     "R and Vertica"                                      
## [5] "RGolf: NGSL Scrabble"                                "European talks. June-July 2014"</code></pre>
<p><img src="https://res.cloudinary.com/johndharrison/image/upload/v1497012296/RSelenium/headless/phantomWebserver.png" title="PhantomJS as a Web Server" style="margin-left: auto;margin-right: auto; display: block;" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#phantomjs">PhantomJS</a></li>
      <li><a href="#x-virtual-frame-buffer">X Virtual Frame Buffer</a></li>
      <li><a href="#phantomjs-api-examples">PhantomJS API Examples</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Harrison, Ju Yeong Kim.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
